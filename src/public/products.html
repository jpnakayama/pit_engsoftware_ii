<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Vitrine — Cupcakes</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="app.js"></script>
</head>
<body>
  <nav class="navbar navbar-light bg-light mb-3 px-3">
    <a class="navbar-brand" href="products.html">Cupcakes</a>
    <div class="ms-auto">
      <a class="btn btn-outline-primary btn-sm me-2" href="cart.html">Carrinho</a>
      <a class="btn btn-outline-secondary btn-sm me-2" href="loyalty.html">Fidelidade</a>
      <a class="btn btn-primary btn-sm" href="login.html">Login</a>
    </div>
  </nav>

  <div class="container">
    <h3>Vitrine</h3>
    <div class="form-check form-switch my-2">
      <input class="form-check-input" type="checkbox" id="onlyMonth">
      <label class="form-check-label" for="onlyMonth">Somente “Cupcake do Mês”</label>
    </div>
    <div id="grid" class="row g-3"></div>
  </div>

  <script>
    async function load() {
      const only = document.getElementById('onlyMonth').checked ? 'true' : 'false';
      const data = await api(`/products?only_month=${only}`);
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      data.items.forEach(p => {
        const col = document.createElement('div'); col.className = 'col-12 col-md-4';
        col.innerHTML = `
          <div class="card h-100">
            <div class="card-body">
              <h5>${p.name}</h5>
              <p class="text-muted">${p.description || ''}</p>
              <div class="d-flex justify-content-between align-items-center">
                <strong>${fmtBRL(p.price_cents)}</strong>
                <button class="btn btn-sm btn-primary" data-id="${p.id}">Adicionar</button>
              </div>
            </div>
          </div>`;
        grid.appendChild(col);
      });
      grid.querySelectorAll('button.btn-primary').forEach(btn => {
        btn.addEventListener('click', async (ev) => {
          if (!getToken()) { alert('Faça login para adicionar.'); return location.href = 'login.html'; }
          const id = Number(ev.currentTarget.getAttribute('data-id'));
          await api('/cart/items', { method: 'POST', body: JSON.stringify({ product_id: id, quantity: 1 }) });
          alert('Adicionado ao carrinho!');
        });
      });
    }
    document.getElementById('onlyMonth').addEventListener('change', load);
    load();
  </script>
</body>
</html>
